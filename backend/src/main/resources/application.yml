spring:
  datasource:
    url: jdbc:postgresql://localhost:9543/rule_engine
    username: postgres
    password: postgres
    driver-class-name: org.postgresql.Driver
  jpa:
    hibernate:
      ddl-auto: none  # Let Flyway handle all schema changes - Declaration entity is not persisted
    properties:
      hibernate:
        format_sql: true
        jdbc:
          time_zone: UTC
    open-in-view: false
  jackson:
    serialization:
      write-dates-as-timestamps: false
  flyway:
    enabled: true
    baseline-on-migrate: true  # Allow Flyway to work with existing database
    locations: classpath:db/migration
    validate-on-migrate: false  # Temporarily disable validation to fix checksum mismatch

server:
  port: 8080
  servlet:
    context-path: /

# CORS Configuration
# Comma-separated list of allowed origins
# Patterns like http://localhost:* are supported
# For development, include localhost patterns: http://localhost:*,https://localhost:*
cors:
  allowed-origins: http://localhost:*,https://localhost:*,https://rule.thinhnguyen.dev

management:
  endpoints:
    web:
      exposure:
        include: health,info

# OpenAI Configuration for AI-powered rule generation
# For production: Set OPENAI_API_KEY and OPENAI_ENABLED environment variables
# For development: Use application-dev.yml profile
openai:
  api-key: ${OPENAI_API_KEY:}
  model: gpt-4o
  temperature: 0.2
  max-tokens: 2000
  timeout: 30 
  enabled: ${OPENAI_ENABLED:false}

security:
  jwt:
    secret: ${AUTH_JWT_SECRET:change-me-in-production-use-32-char-secret-minimum}
    issuer: rule-engine-service
    access-token-ttl: PT15M
    refresh-token-ttl: P7D

auth:
  bootstrap:
    administrator:
      email: ${AUTH_BOOTSTRAP_ADMIN_EMAIL:rule.admin@local}
      password: ${AUTH_BOOTSTRAP_ADMIN_PASSWORD:ChangeMe123!}
      display-name: ${AUTH_BOOTSTRAP_ADMIN_NAME:Rule Administrator}
    editor:
      email: ${AUTH_BOOTSTRAP_EDITOR_EMAIL:rule.editor@local}
      password: ${AUTH_BOOTSTRAP_EDITOR_PASSWORD:ChangeMe123!}
      display-name: ${AUTH_BOOTSTRAP_EDITOR_NAME:Rule Editor}

