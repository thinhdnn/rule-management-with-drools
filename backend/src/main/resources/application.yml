spring:
  datasource:
    url: jdbc:postgresql://localhost:9543/rule_engine
    username: postgres
    password: postgres
    driver-class-name: org.postgresql.Driver
  jpa:
    hibernate:
      ddl-auto: none  # Let Flyway handle all schema changes - Declaration entity is not persisted
    properties:
      hibernate:
        format_sql: true
        jdbc:
          time_zone: UTC
    open-in-view: false
  jackson:
    serialization:
      write-dates-as-timestamps: false
  flyway:
    enabled: true
    baseline-on-migrate: true  # Allow Flyway to work with existing database
    locations: classpath:db/migration
    validate-on-migrate: false  # Temporarily disable validation to fix checksum mismatch

server:
  port: 8080
  servlet:
    context-path: /

# CORS Configuration
# Comma-separated list of allowed origins
# Patterns like http://localhost:* are supported
# For development, include localhost patterns: http://localhost:*,https://localhost:*
cors:
  allowed-origins: http://localhost:*,https://localhost:*,https://rule.thinhnguyen.dev

management:
  endpoints:
    web:
      exposure:
        include: health,info

# AI Configuration for AI-powered rule generation (OpenRouter or OpenAI)
# For production: Set AI_API_KEY and AI_ENABLED environment variables
# For development: Use application-dev.yml profile
# Provider options: "openrouter" (default) or "openai"
# OpenRouter models: "openai/gpt-4o", "anthropic/claude-3.5-sonnet", etc.
# OpenAI models: "gpt-4o", "gpt-4-turbo", etc.
ai:
  api-key: ${AI_API_KEY:}
  provider: ${AI_PROVIDER:openrouter} # "openrouter" or "openai"
  base-url: ${AI_BASE_URL:} # Optional, defaults based on provider
  model: ${AI_MODEL:openai/gpt-4o} # OpenRouter format: "provider/model-name"
  temperature: 0.2
  max-tokens: 2000
  timeout: 30
  enabled: ${AI_ENABLED:false}
  http-referer: ${AI_HTTP_REFERER:} # Optional, for OpenRouter
  http-title: ${AI_HTTP_TITLE:} # Optional, for OpenRouter

security:
  jwt:
    secret: ${AUTH_JWT_SECRET:change-me-in-production-use-32-char-secret-minimum}
    issuer: rule-engine-service
    access-token-ttl: PT15M
    refresh-token-ttl: P7D

auth:
  bootstrap:
    administrator:
      email: ${AUTH_BOOTSTRAP_ADMIN_EMAIL:rule.admin@local}
      password: ${AUTH_BOOTSTRAP_ADMIN_PASSWORD:ChangeMe123!}
      display-name: ${AUTH_BOOTSTRAP_ADMIN_NAME:Rule Administrator}
    editor:
      email: ${AUTH_BOOTSTRAP_EDITOR_EMAIL:rule.editor@local}
      password: ${AUTH_BOOTSTRAP_EDITOR_PASSWORD:ChangeMe123!}
      display-name: ${AUTH_BOOTSTRAP_EDITOR_NAME:Rule Editor}

